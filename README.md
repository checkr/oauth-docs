# Checkr OAuth Integration Guide

With Checkr OAuth integration, your customers can easily connect their Checkr account with your platform. OAuth 2 is a protocol that provides access to your end user's Checkr account upon their approval, without knowing their specific credentials.

At Checkr, multiple users can belong to one account. Our OAuth integration works at the account level instead of the user level, meaning that end users will authenticate and deauthenticate on behalf of their account. This means that it is only necessary for one individual end user from one account to go through the OAuth integration flow, since the account they belong to will be authenticated for all of the account's users.

Since this behavior deviates from traditional OAuth integrations done at the user level, we will clarify vocabulary before moving on:

- Partner: You, the reader.
- Platform: Your application that will have Checkr integration available. Your end users use this platform.
- End user: Your users.
- Integrated account: The Checkr account of an end user. Note that multiple of your end users can belong to the same Checkr account. You will receive an `access_token` that will serve as the API key for each integrated account, not for each end user.

## General overview of integration flow

When an end user wants to connect their Checkr account to your platform, they’ll go through these steps:

1. On your website, the end user will click a link that takes them to Checkr. The link will pass along your platform `client_id`.
2. Once on Checkr’s website, the end user will be prompted to authorize your platform to manage resources on their behalf by either:
    - Creating a new account with a credit card
    - Logging into their existing account
    - If they are already logged in, simply authorizing the platform
3. The end user will then be redirected back to your site (specifically to your `redirect_uri`), passing along an authorization `code`.
4. Using this `code`, your application will be able to create an `access_token` for the end user and store it in your data store.
5. If the integrated Checkr account has yet to be credentialed to run background checks, Checkr will initiate the credentialing process.
5. Subsequent API requests can be made on behalf of the integrated account using the `access_token` in place of the `API_KEY` or `TEST_API_KEY` typically used for Checkr API requests.

## Integration setup
Please email clients@checkr.com to register your platform, if you haven't already.

You will need to provide the following:

| Field | Description | Example |
|-------|-------------|---------|
| `name`| Name of your platform. | Partner Inc |
|`description`| A short description of your platform. | Partner Inc is awesome.  |
|`url`| The url of your platform. | https://partnerinc.com |
|`redirect_uri` | A page on your platform to which the end user will be redirected after connecting their integrated account (or failing to, should that be the case). It must follow the HTTPS protocol. | https://partnerinc.com/integrations/checkr |
|`webhook_url`|An endpoint to which we will send webhooks to when certain events occur. | https://partnerinc.com/webhooks/checkr |
|`logo_url`| A url to the logo of your platform. | https://partnerinc.com/assets/logo.png |

The following will be provided to you when you register your platform:

- Your `client_id`, a unique identifier for your platform, generated by Checkr.
- Your `client_secret`, a unique secret for your platform, generated by Checkr.

The `client_secret` should not be shared.

### Test integration setup

In order to use OAuth integration in test mode, the partner must reach out to clients@checkr.com to generate a test `client_id` and test `client_secret`. When an end user authenticates your platform to manage resources for their integrated account, Checkr will return a test `access_token` to you. Using the test `access_token` in API requests will create, update, and delete test resources.

In test mode, a credit card will not be created nor saved when a end user signs up for Checkr to authenticate your platform.

Test SSNs and driver licenses are available for use and are detailed in [the Checkr API documentation](https://docs.checkr.com/#development).

## Integration
### End user authorization

With these pieces of information on hand, you’re ready to have your end users connect to Checkr within your platform. We recommend showing a Connect button that sends them to our authorize url endpoint:

```
https://dashboard.checkr.com/oauth/authorize/:client_id?scope=read_write
```

You can also specifically redirect users to the /signin or /signup endpoint specifically depending on whether you know they have already set up an account with Checkr. The URLs for both options are as follows:

**Sign in**
```
https://partners.checkr.com/authorize/:client_id/signin?scope=read_write
```

**Sign up**
```
https://partners.checkr.com/authorize/:client_id/signup?scope=read_write
```

To prevent CSRF attacks, you can also use the `state` parameter, passing along a unique token as the value. We’ll include the `state` you gave us when we redirect back.

Here is how this may look:

![Connect with Checkr](https://assets.checkr.com/assets/images/connect_with_checkr.png)


### Token issuance

When the end user arrives at Checkr, they’ll be prompted to allow or deny the connection to your platform, and will then be sent to your `redirect_uri` page. In the URL, we’ll pass along an authorization code:

```
https://YOUR-REDIRECT-URI.com/REDIRECT-ENDPOINT?scope=read_write&code=AUTHORIZATION_CODE
```

Using the `code` parameter, you should make a POST request to our tokens endpoint to retrieve the `access_token`:

```curl
curl -X POST https://api.checkr.com/oauth/tokens \
    -d client_id=YOUR_CLIENT_ID \
    -d client_secret=YOUR_CLIENT_SECRET \
    -d code=AUTHORIZATION_CODE
```

Note that requests made with your live credentials will return a live `access_token` and requests with tests credentials will return a test `access_token`.

Checkr will return a response containing the `access_token` for the integrated account:

```json
{
  "access_token": "xoxt-23984754863-2348975623103",
  "scope": "read_write",
  "checkr_account_id": "67778dfa52ebbdtssb2f2322"
}
```

You’re done! The end user has now authorized your platform to manage the account they belong to.  You’ll want to store all of the returned information in your database for later use.

### Integrated account credentialing

It's important for each integrated account to be credentialed to have background checks run on their behalf by you, the partner.

For integrated accounts who already are credentialed, we will send a `account.credentialed` webhook to you as soon as a token is created for the integrated account.

For end users who are either new or have an account that has not been credentialed yet, our Customer Success team will contact the end user to lead them through the credentialing process. Upon creation of their account and payment set up, your end user will receive an email asking to fill two specific forms that are compulsory for compliance under the FCRA. The goal of these forms is to prove that your end user will use background checks for a “permissible purpose under the FCRA”. These two forms are:

- Checkr Account Authorization form
- Checkr MSA and Employment Certification Addendum

It will take Checkr Customer Success team up to 1 business day to process their credentialing request, upon which, the integrated account will be fully-authorized and you can begin processing background checks on your platform on behalf of the account.

Once the process is complete, Checkr will issue a `account.credentialed` webhook to the `webhook_url` specified during application sign up. We will also notify the end user tied to the integrated account via email.

### Make API calls using user tokens

You can now make requests to the [Checkr API](https://docs.checkr.com) using the `access_token`.

```curl
curl -X GET https://api.checkr.com/v1/candidates \
    -u INTEGRATED_ACCOUNT'S_ACCESS_TOKEN:
```

### User deauthorization

#### From Checkr's dashboard
A `token.deauthorized` webhook event is sent when an end user disconnects their integrated account from your platform. By watching for this event, you can perform any necessary credential cleanup on your servers. Note that a managed account cannot be disconnected by the account’s beneficiary.

#### From your system

Additionally, if you want to disconnect access to an integrated account, you can POST to `https://api.checkr.com/oauth/deauthorize`:

```curl
curl -X POST https://api.checkr.com/oauth/deauthorize \
   -u INTEGRATED_ACCOUNT'S_ACCESS_TOKEN:
```

### Packages (Additional per-account configuration steps)
You may want to have a dynamic way of creating and listing a report's package on a per-account basis. To add packages, you will need to manage `Package`s of every integrated account by making requests to our Packages API using the `access_token` for the integrated. If you are using a test `client_id` and test `client_secret`, we will automatically create test default packages for an end user's account. The default packages are `tasker_standard`, `tasker_pro`, `driver_standard`, and `driver_pro`. See more details about the package types [here](https://docs.checkr.com/#getting-started) under `Create a Report`.

See the [Checkr Packages API](https://github.com/checkr/oauth-docs/blob/master/checkr_packages_api.md) for a complete guide.

## Webhooks

Webhooks will be sent for resources created using an integrated account's `access_token`. For example, when you create a report on behalf of an integrated account, a webhook will be sent to the `webhook_url` specified during registration. It will also be sent to the webhooks that the account has set up independent of your platform, if any. Please contact `clients@checkr.com` if you need to change `webhook_url`.

In addition to webhooks for events related to Checkr resources such as reports or candidates, we also send webhooks for events related to your OAuth integration.

- When integrated accounts become credentialed
- When integrated accounts are deauthorized from your platform

For security reasons, you might want to verify that the requests you receive come from Checkr.

We pass along a hash signature with each request in the header X-Checkr-Signature. When you receive a request, you can compute a hash and ensure that the one from Checkr matches.

The hash signature is generated with the HMAC algorithm, using your `client_id` as a key and SHA256 digest mode.

See [Checkr OAuth Webhooks](https://github.com/checkr/oauth-docs/blob/master/checkr_webhooks_api.md) for a more detailed look.

## 5. Checkr OAuth full API Reference

See the [Checkr OAuth Full Reference](https://github.com/checkr/oauth-docs/blob/master/checkr_oauth_full_reference.md) for a complete guide on the Checkr OAuth API.
